<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>날짜 선택</title>
</head>
<body>
    <h1>날짜 선택</h1>
    <section>
        <h2>날짜를 선택하세요</h2>
        <input type="date" id="selectedDate">
    </section>
    <h3>예약 현황:</h3>
    <ul id="dateReservationList"></ul>
    <button id="nextButton">다음</button>

    <script type="module">
        import { db } from '/js/firebase.js';
        import { storeData } from '/js/reservation.js';
        import { collection, getDocs, query, where } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js";

        async function loadDateReservations() {
            const selectedDate = document.getElementById('selectedDate').value;
            const q = query(collection(db, "reservations"), where("date", "==", selectedDate));
            const querySnapshot = await getDocs(q);

            const reservationList = document.getElementById("dateReservationList");
            reservationList.innerHTML = "";

            querySnapshot.forEach((doc) => {
                const data = doc.data();
                const listItem = document.createElement("li");
                listItem.textContent = `장소: ${data.locations.join(", ")}, 시간: ${data.timeSlots.join(", ")}`;
                reservationList.appendChild(listItem);
            });
        }

        function goToNextPage() {
            const selectedDate = document.getElementById('selectedDate').value;
            storeData('selectedDate', selectedDate);
            window.location.href = 'time_selection.html';
        }

        document.getElementById('nextButton').addEventListener('click', goToNextPage);
        
        // 날짜 선택 시 loadDateReservations 함수 호출
        document.getElementById('selectedDate').addEventListener('change', loadDateReservations);
    </script>
</body>
</html>
